<script>
    const getQueryVar = varName => {
        const queryStr = `${decodeURIComponent(window.location.search)}&`;
        const regex = new RegExp(`.*?[&\\?]${varName}=(.*?)&.*`);
        let val = queryStr.replace(regex, "$1");
        return val == queryStr ? null : val;
    };

    fetch("/token", {
        headers: {
            Authorization: getQueryVar("code")
        }
    }).then(async res => {
        if (res.status !== 200) return document.write("Something went wrong. <a href='/app.html'>Try again</a>.");
        localStorage.setItem("token", await res.text());
        location.href = "/app.html";
    });
</script>